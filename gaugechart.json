{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "description": "A simple donut chart with embedded data.",
  "data": {
    "url": "https://raw.githubusercontent.com/joeechua/FIT3179_A2/main/fortune_500_USA.csv",
    "format": {"parse": {"profits": "number", "revenues": "number"}}
  },
  "title": null,
  "width": 350,
  "height": 400,
  "background": null,
  "params": [
    {
      "name": "company_selection",
      "bind": {
        "input": "select",
        "options": [
          null,
          "Micron Technology",
          "Facebook",
          "Amgen",
          "Intel",
          "Meta Platforms",
          "Bank of America Corp.",
          "Eli Lilly",
          "JPMorgan Chase & Co.",
          "Philip Morris International",
          "JPMorgan Chase",
          "Alphabet",
          "Apple",
          "Pfizer",
          "Coca-Cola",
          "U.S. Bancorp",
          "Bank of America",
          "Truist Financial",
          "Johnson & Johnson",
          "Morgan Stanley",
          "ConocoPhillips",
          "Goldman Sachs Group",
          "Microsoft",
          "Merck",
          "Honeywell International",
          "Thermo Fisher Scientific",
          "3M",
          "Starbucks",
          "Mondelez International",
          "Citigroup",
          "Verizon Communications",
          "Enterprise Products Partners",
          "Fannie Mae",
          "Netflix",
          "State Farm Insurance Cos.",
          "Raytheon",
          "Comcast",
          "PepsiCo",
          "AbbVie",
          "Home Depot",
          "Oracle",
          "Freddie Mac",
          "Nucor",
          "Lockheed Martin",
          "Paccar",
          "ViacomCBS",
          "Delta Air Lines",
          "Capital One Financial",
          "General Dynamics",
          "Travelers Cos.",
          "Travelers",
          "American Express",
          "Progressive",
          "United Technologies",
          "Abbott Laboratories",
          "International Business Machines",
          "MetLife",
          "USAA",
          "Caterpillar",
          "HCA Healthcare",
          "Northrop Grumman",
          "Publix Super Markets",
          "Deere",
          "Dollar General",
          "Procter & Gamble",
          "Allstate",
          "Exelon",
          "Nike",
          "UnitedHealth Group",
          "Dollar Tree",
          "United Airlines Holdings",
          "HP",
          "General Motors",
          "Tyson Foods",
          "State Farm Insurance",
          "DuPont",
          "Macy's",
          "Amazon",
          "Wells Fargo",
          "Target",
          "Anthem",
          "Best Buy",
          "Cigna",
          "Lowe's",
          "American Airlines Group",
          "Humana",
          "Charter Communications",
          "Archer Daniels Midland",
          "Tesla",
          "Costco Wholesale",
          "TD Synnex",
          "Archer Daniels Midland (ADM)",
          "Liberty Mutual Insurance Group",
          "Berkshire Hathaway",
          "United Parcel Service",
          "Centene",
          "CHS",
          "US Foods Holding",
          "Kroger",
          "TIAA",
          "Walmart",
          "Northwestern Mutual",
          "Massachusetts Mutual Life Insurance",
          "Plains GP Holdings",
          "Tech Data",
          "FedEx",
          "Albertsons",
          "Gilead Sciences",
          "PBF Energy",
          "Sysco",
          "Walgreens Boots Alliance",
          "World Fuel Services",
          "TJX",
          "StoneX",
          "Cisco Systems",
          "Albertsons Cos.",
          "INTL FCStone",
          "Jabil",
          "CVS Health",
          "Nationwide",
          "Rite Aid",
          "Performance Food Group",
          "Prudential Financial",
          "Arrow Electronics",
          "Ford Motor",
          "United Natural Foods",
          "Hewlett Packard Enterprise",
          "Energy Transfer",
          "New York Life Insurance",
          "AmerisourceBergen",
          "McKesson",
          "Valero Energy",
          "Cardinal Health",
          "Dell Technologies",
          "AT&T",
          "Bunge",
          "Dow",
          "Walt Disney",
          "Chevron",
          "Phillips 66",
          "Raytheon Technologies",
          "Marathon Petroleum",
          "Exxon Mobil",
          "U.S. Postal Service",
          "American International Group",
          "General Electric",
          "Boeing",
          "Bristol-Myers Squibb",
          "Schlumberger",
          "Kraft Heinz"
        ],
        "labels": [
          "Overall",
          "Micron Technology",
          "Facebook",
          "Amgen",
          "Intel",
          "Meta Platforms",
          "Bank of America Corp.",
          "Eli Lilly",
          "JPMorgan Chase & Co.",
          "Philip Morris International",
          "JPMorgan Chase",
          "Alphabet",
          "Apple",
          "Pfizer",
          "Coca-Cola",
          "U.S. Bancorp",
          "Bank of America",
          "Truist Financial",
          "Johnson & Johnson",
          "Morgan Stanley",
          "ConocoPhillips",
          "Goldman Sachs Group",
          "Microsoft",
          "Merck",
          "Honeywell International",
          "Thermo Fisher Scientific",
          "3M",
          "Starbucks",
          "Mondelez International",
          "Citigroup",
          "Verizon Communications",
          "Enterprise Products Partners",
          "Fannie Mae",
          "Netflix",
          "State Farm Insurance Cos.",
          "Raytheon",
          "Comcast",
          "PepsiCo",
          "AbbVie",
          "Home Depot",
          "Oracle",
          "Freddie Mac",
          "Nucor",
          "Lockheed Martin",
          "Paccar",
          "ViacomCBS",
          "Delta Air Lines",
          "Capital One Financial",
          "General Dynamics",
          "Travelers Cos.",
          "Travelers",
          "American Express",
          "Progressive",
          "United Technologies",
          "Abbott Laboratories",
          "International Business Machines",
          "MetLife",
          "USAA",
          "Caterpillar",
          "HCA Healthcare",
          "Northrop Grumman",
          "Publix Super Markets",
          "Deere",
          "Dollar General",
          "Procter & Gamble",
          "Allstate",
          "Exelon",
          "Nike",
          "UnitedHealth Group",
          "Dollar Tree",
          "United Airlines Holdings",
          "HP",
          "General Motors",
          "Tyson Foods",
          "State Farm Insurance",
          "DuPont",
          "Macy's",
          "Amazon",
          "Wells Fargo",
          "Target",
          "Anthem",
          "Best Buy",
          "Cigna",
          "Lowe's",
          "American Airlines Group",
          "Humana",
          "Charter Communications",
          "Archer Daniels Midland",
          "Tesla",
          "Costco Wholesale",
          "TD Synnex",
          "Archer Daniels Midland (ADM)",
          "Liberty Mutual Insurance Group",
          "Berkshire Hathaway",
          "United Parcel Service",
          "Centene",
          "CHS",
          "US Foods Holding",
          "Kroger",
          "TIAA",
          "Walmart",
          "Northwestern Mutual",
          "Massachusetts Mutual Life Insurance",
          "Plains GP Holdings",
          "Tech Data",
          "FedEx",
          "Albertsons",
          "Gilead Sciences",
          "PBF Energy",
          "Sysco",
          "Walgreens Boots Alliance",
          "World Fuel Services",
          "TJX",
          "StoneX",
          "Cisco Systems",
          "Albertsons Cos.",
          "INTL FCStone",
          "Jabil",
          "CVS Health",
          "Nationwide",
          "Rite Aid",
          "Performance Food Group",
          "Prudential Financial",
          "Arrow Electronics",
          "Ford Motor",
          "United Natural Foods",
          "Hewlett Packard Enterprise",
          "Energy Transfer",
          "New York Life Insurance",
          "AmerisourceBergen",
          "McKesson",
          "Valero Energy",
          "Cardinal Health",
          "Dell Technologies",
          "AT&T",
          "Bunge",
          "Dow",
          "Walt Disney",
          "Chevron",
          "Phillips 66",
          "Raytheon Technologies",
          "Marathon Petroleum",
          "Exxon Mobil",
          "U.S. Postal Service",
          "American International Group",
          "General Electric",
          "Boeing",
          "Bristol-Myers Squibb",
          "Schlumberger",
          "Kraft Heinz"
        ],
        "name": "Select Company: "
      },
      "value": "Micron Technology"
    }
  ],
  "transform": [
    {"filter": "company_selection == null || datum.name == company_selection"},
    {"calculate": "((datum.profits) / datum.revenues)", "as": "rpe"},
    {"calculate": "(datum.rpe)*100", "as": "rpe_perc"},
    {"calculate": "100 - datum.rpe_perc", "as": "company_exp"},
    {"calculate": "datum.company_exp/100*263", "as": "rpe_angle"},
    {"calculate": "-2.28  + (datum.rpe_angle *PI/180)", "as": "rpe_rad"},
    {"calculate": "datum.revenues - datum.profits", "as": "expenses"},
    {
      "window": [{"op": "rank", "as": "least_exp"}],
      "sort": [{"field": "rpe", "order": "descending"}]
    },
    {"filter": "datum.least_exp == 1"}
  ],
  "layer": [
    {
      "mark": {
        "type": "arc",
        "theta": -2.28,
        "theta2": 2.28,
        "radius": 120,
        "innerRadius": 185
      },
      "encoding": {"fill": {"value": "lightgrey"}}
    },
    {
      "mark": {
        "type": "arc",
        "theta": -2.28,
        "radius": 120,
        "innerRadius": 185,
        "theta2": {"expr": "company_selection == null ? -1.8 : datum.rpe_rad"}
      },
      "encoding": {
        "stroke": {"value": "black"},
        "color": {
          "field": "company_exp",
          "title": "Percentage of Revenue",
          "type": "quantitative",
          "scale": {
            "domain": [0, 60, 80, 100],
            "range": ["#0B1D51", "lightgreen", "white", "#BF0A30"]
          },
          "legend": {"orient": "none", "title": "Efficiency Ratio",
          "legendX":-20, "legendY":360, "direction": "horizontal", "gradientLength":355}
        },
        "tooltip": [
          {"field": "expenses"},
          {"field": "profits"},
          {"field": "revenues"}
        ]
      }
    },
    {
      "mark": {
        "type": "point",
        "x": 175,
        "y": 199,
        "angle": {
          "expr": "company_selection == null ? -104: datum.rpe_angle - 130"
        },
        "shape": "M 0 -111 L 2 0 Q 0 2 -2 0 L 0 -111"
      },
      "encoding": {
        "color": {"value": "black"},
        "fill": {"value": "black"},
        "size": {"value": 5}
      }
    },
    {
      "mark": {
        "type": "text",
        "x": 70,
        "y": 290,
        "text": "0",
        "fontWeight": "bold",
        "fontSize": 25,
        "color": "black"
      }
    },
    {
      "mark": {
        "type": "text",
        "x": 270,
        "y": 290,
        "text": "100",
        "fontWeight": "bold",
        "fontSize": 25,
        "color": "black"
      }
    },
    {
      "mark": {
        "type": "text",
        "x": 35,
        "y": 180,
        "text": "20",
        "fontWeight": "bold",
        "fontSize": 25,
        "color": "black"
      }
    },
    {
      "mark": {
        "type": "text",
        "x": 90,
        "y": 85,
        "text": "40",
        "fontWeight": "bold",
        "fontSize": 25,
        "color": "black"
      }
    },
    {
      "mark": {
        "type": "text",
        "x": 310,
        "y": 180,
        "text": "80",
        "fontWeight": "bold",
        "fontSize": 25,
        "color": "black"
      }
    },
    {
      "mark": {
        "type": "text",
        "x": 250,
        "y": 85,
        "text": "60",
        "fontWeight": "bold",
        "fontSize": 25,
        "color": "black"
      }
    },
    {
      "mark": {
        "type": "point",
        "x": 56,
        "y": 302,
        "angle": -130,
        "shape": "M 0 -10 L 0 -1 L 0 -1"
      },
      "encoding": {"color": {"value": "black"}}
    },
    {
      "mark": {
        "type": "point",
        "x": -10,
        "y": 170,
        "angle": 100,
        "shape": "M 0 -10 L 0 -1 L 0 -1"
      },
      "encoding": {"color": {"value": "black"}}
    },
    {
      "mark": {
        "type": "point",
        "x": 360,
        "y": 170,
        "angle": -100,
        "shape": "M 0 -10 L 0 -1 L 0 -1"
      },
      "encoding": {"color": {"value": "black"}}
    },
    {
      "mark": {
        "type": "point",
        "x": 295,
        "y": 302,
        "angle": 130,
        "shape": "M 0 -10 L 0 -1 L 0 -1"
      },
      "encoding": {"color": {"value": "black"}}
    },
    {
      "mark": {
        "type": "point",
        "x": 286,
        "y": 50,
        "angle": -140,
        "shape": "M 0 -10 L 0 -1 L 0 -1"
      },
      "encoding": {"color": {"value": "black"}}
    },
    {
      "mark": {
        "type": "point",
        "x": 60,
        "y": 50,
        "angle": 140,
        "shape": "M 0 -10 L 0 -1 L 0 -1"
      },
      "encoding": {"color": {"value": "black"}}
    },
    {
      "mark": {
        "type": "text",
        "x": 155,
        "y": 300,
        "text": {
          "expr": "company_selection == null ? 10: round(datum.company_exp)"
        },
        "fontWeight": "bold",
        "fontSize": 60,
        "color": "black"
      }
    },
    {
      "mark": {
        "type": "text",
        "x": 205,
        "y": 298,
        "text": "%",
        "fontWeight": "bold",
        "fontSize": 40,
        "color": "black"
      }
    }
  ]
}